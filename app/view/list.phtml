<?php
/*
* В этот скрипт передаются следующие переменные:
*
* $cloud_tags[]
* $money_in_type_link
* $money_out_type_link
* $date_links[]
* $date_start
* $date_end
* $date_links[]
* $hidden_inputs[]
* $select[]
* $events_list[]
* $total_in
* $total_out
* $total
* ~$no_limit_link
* ~$found_rows
* $new_button_link
*/
?>
<script type="text/javascript" src="js/kalender.js"></script>
<script type="text/javascript" src="js/myfinEditForm.js"></script>
<script type="text/javascript">
function create_show_form ( id, tags, desc, value, type, action_url, date ){
    var form = new myfinEditForm({
        parent: 'td4_item_form_' + id,
        tags: tags,
        description: desc,
        value: value,
        type: type,
        id: id,
        action: action_url,
        date: date,
        tag_list: <?php echo $tag_list?>
    });

    form.show();

    var tmp = document.getElementById('edit_button_' + id);
    tmp.onclick = function(){form.toggle(); return false;}
    tmp = document.getElementById('description_text_' + id);
    tmp.onclick = function(){form.toggle(); return false;}

    return false;
}
</script>

<div id="side_bar">

<h3>Период:</h3>
<ul>
<?php foreach ($date_links as $date_link) : ?>
<li><a href="<?php echo $date_link['link'] ?>"><?php echo $date_link['name'] ?></a></li>
<?php endforeach; ?>
</ul>

<sub>за последние</sub><br>
<?php foreach ($date_links_d as $date_link) : ?>
<a href="<?php echo $date_link['link'] ?>"><?php echo $date_link['name'] ?></a>
<?php endforeach; ?>
<br><sup>дней</sup>

<form action="" method="GET">
<span class="s_po">с</span>
<div class="cal_wrap">
<input id="date_input1" class="date_input" name="date_start" type="text" value="<?php echo $date_start ?>">
<div id="toggle_cal1" class="toggle_cal"></div>
<div id="calendar1" class="calendar"></div>
</div>
<br>
<span class="s_po">по</span>
<div class="cal_wrap">
<input id="date_input2" class="date_input" name="date_end" type="text" value="<?php echo $date_end ?>">
<div id="toggle_cal2" class="toggle_cal"></div>
<div id="calendar2" class="calendar"></div>
</div>
<br>
<input type="submit" value="задать">
<?php foreach ($hidden_inputs as $k => $v) : ?>
<input name="<?php echo $k ?>" type="hidden" value="<?php echo $v ?>">
<?php endforeach; ?>
</form>


<h3>Тип:</h3>
<ul>
<li><a href="<?php echo $money_in_type_link ?>" class="money_in">прибыль</a></li>
<li><a href="<?php echo $money_out_type_link ?>" class="money_out">расход</a></li>
</ul>


<h3>Теги:</h3>
<ul>
<?php foreach ($cloud_tags as $tag): ?>
<li><a href="<?php echo $tag['link'] ?>">
<?php echo $tag['name'] ?></a> (<?php echo $tag['count'] ?>)</li>
<?php endforeach; ?>
</ul>


</div><!-- / #side_bar -->


<div id="content">

<!-- параметры запроса -->
<?php if (count($select) > 0) : ?>
<div class="select">
<?php foreach ($select as $value) : ?>
<?php echo $value['text']; ?> <a href="<?php echo $value['link'] ?>">[x]</a><br>
<?php endforeach; ?>
</div>
<?php endif; ?>

<!-- основная такблица (с событиями) -->
<table class="events_list">
<tr><td colspan="4" id="new_item_row">Новая запись</td></tr>
<tr class="form_container_tr">
<td colspan="4" class="td4_item_form" id="td4new_item_form"></td>
</tr>

<?php foreach ($events_list as $e) : ?>
<tr>
<td class="description">
<a class="<?php echo $e['type_str'] ?>"
href="<?php echo $e['edit_link'] ?>" title="правка"
id="description_text_<?php echo $e['id'] ?>"
onclick="return create_show_form(<?php echo $e['form_params_str'] ?>);">
<?php echo $e['description'] ?>
</a>
<span class="tags_list">
<?php foreach ($e['tag_list'] as $tag) : ?>
<span><a href="<?php echo $tag['link'] ?>"><?php echo $tag['name'] ?></a><a
   class="r_tag" title="удалить тег" href="<?php echo $tag['remove_link'] ?>">x</a></span>

<?php endforeach; ?>
</span>
</td>
<td class="buttons">
<a class="button edit"
   id="edit_button_<?php echo $e['id'] ?>"
   onclick="return create_show_form(<?php echo $e['form_params_str'] ?>);"
   href="<?php echo $e['edit_link'] ?>" title="правка"></a>
<a class="button remove"
href="<?php echo $e['remove_link'] ?>"
onclick="return confirm('Удалить запись?');" title="удалить"></a>
</td>
<td class='value <?php echo $e['type_str'] ?>'>
<?php echo $e['symbol'] . number_format($e['value'], 2, ',', ' '); ?>
</td>
<td class="date">
<?php echo Util::readlyTime($e['date']) ?>
</td>
</tr>
<tr class="form_container_tr"><td colspan="4" id="td4_item_form_<?php echo $e['id'] ?>"></td>
</tr>
<?php endforeach; ?>

</table>

<hr>Итого:
<span class='money_in'><?php echo $total_in ?></span>
- <span class='money_out'><?php echo $total_out ?></span>
= <span class='<?php echo ($total > 0) ? 'money_in' : 'money_out' ?>'><?php echo $total ?></span>

<!-- ссылка "показать всё", если нужна -->
<?php if (isset($no_limit_link)): ?>
<center>показаны первые <?php echo get_config('items_on_page') ?><br>
<a href="<?php echo $no_limit_link ?>">показать все</a> (<?php echo $found_rows ?>)</center>
<?php endif; ?>

<!-- кнопка "добавить" ->
<div style="text-align: right;">
<a class="add_button" href="<?php echo $new_button_link ?>">Добавить</a>
</div-->


</div><!-- / #content -->

<script type="text/javascript">
new function() {
new Kalender('date_input1', 'calendar1', 'toggle_cal1', true);
new Kalender('date_input2', 'calendar2', 'toggle_cal2');

new myfinEditForm({
        parent: 'td4new_item_form',
        tag_list: <?php echo $tag_list?>,
        toggle_button: 'new_item_row',
        action: '<?php echo $new_button_link ?>'
    });
}();
</script>